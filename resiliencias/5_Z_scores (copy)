/**
 * This script generates and exports rasters with the z score for each image generated in steps 1:4 in Gee
 * 
 * 

- Steps to calculate Z-scores

1- Calculate the mean and standard deviation for the extention of the images 

2- Subtract the mean from value for each pixel and divide by the sd

3- Export

*/


var win_images = ee.Image('projects/ee-lucasljardim9/assets/elevation_range_residual');
//var win_images = ee.Image('projects/ee-lucasljardim9/assets/landform_variety');
//var win_images = ee.Image('projects/ee-lucasljardim9/assets/wetlands_count');
//var win_images = ee.Image('projects/ee-lucasljardim9/assets/wetlands_density');
//var win_images = ee.Image('projects/ee-lucasljardim9/assets/wetlands_density_1000');


// Coding the function to apply the formula of Z-Scores for any raster image that we need

var calculate_Z_scores = function(image) {
  // Calculate mean and standard deviation
  var mean = image.reduceRegion({
    reducer: ee.Reducer.mean(),
    scale: 92.76624,
    bestEffort: true
  });print('Global Mean', mean);

  var sd = image.reduceRegion({
    reducer: ee.Reducer.stdDev(),
    scale: 92.76624,
    bestEffort: true
  }); print('Global sd', sd)

  // Extract the mean and standard deviation values from the dictionaries into a raster
var meanValue = ee.Image.constant(mean
                                  .values()
                                  .get(0));
                                  print('mean Dictionary', meanValue);
                                  
  var sdValue = ee.Image.constant(sd
                                  .values()
                                  .get(0));
                                  print('sd dictionary', sdValue);

  // Calculate z for the current image
  var z = image.subtract(meanValue).divide(sdValue);

  // Return the z image
  return z.rename('z');
};


var Z = calculate_Z_scores(win_images);

Map.addLayer(Z, {}, 'Z-Scores');

Map.addLayer(win_images, {}, 'Original');

Export.image.toAsset({image: Z, 
                      description: "Z-Scores_elevation_range_residual", 
                      assetId: "Z-Scores_elevation_range_residual", 
                      pyramidingPolicy:"mean", 
                      scale: variable.projection().nominalScale(),
                      maxPixels: 1e13});



//Map.addLayer(image, value: "z-score")
//Map.addLayer(Z)
//Map.centerObject(Z)
/*
// Reduce the collection with a median reducer.
        var median = current_index.reduce(ee.Reducer.median());
        // Reduce the collection with a stdDev reducer.
        var stdDev = current_index.reduce(ee.Reducer.stdDev());
        // return image with median and stdDev
        
        */