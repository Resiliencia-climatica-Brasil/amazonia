//************************************ Landscape Diversity******************************************************

var biome = ee.FeatureCollection("projects/ee-lucasljardim9/assets/Biome")
                       .select("Bioma")
                       .filter(ee.Filter.eq("Bioma", "Cerrado"));

var brazil_raster = ee.Image("projects/ee-resilience/assets/brasil_raster");

var scale = brazil_raster.projection().nominalScale();
var geometry = brazil_raster.geometry();

var resilience = ee.Image('projects/ee-resilience/assets/Moving_window_NEWSCALE/Resilience_ORIGINAL_UNMASKED_200');

var landform = ee.Image('projects/ee-lucasljardim9/assets/landform_types')
.updateMask(brazil_raster);





var histogram = landform.reduceRegion({reducer:ee.Reducer.frequencyHistogram(), 
                                  geometry: landform.geometry(), 
                                  scale: 92.76624, 
                                  maxPixels:1e13
                                  });print(histogram)
                                  
var image_classes = ee.Dictionary(histogram.get("sum")).keys();
print(image_classes);


var frequency = function(classCodes) {
  // Create an empty dictionary to store frequencies for each class code.
  var frequencies = ee.Dictionary({});
  
  // Loop through the class codes and calculate frequencies for each.
  for (var i = 0; i < classCodes.length; i++) {
    var code = classCodes[i];
    
    // Create a binary mask for the specific class code.
  var mask = landform
             .where(landform.eq(ee.Number.parse(code)), 1)
             .where(landform.neq(ee.Number.parse(code)), 0);

  var map1 = resilience.mask(mask); 
    
    // Calculate the frequency of the extracted values.
    var count = map1
      .reduceRegion({
        reducer: ee.Reducer.frequencyHistogram(),
        geometry: geometry,
        scale: scale,
        maxPixels: 1e13
      });
    // Store the frequency in the dictionary using the class code.
    frequencies = frequencies.set(code, ee.Dictionary(count));
  }
    return frequencies;
};

var image_classes = [
                      '11.0',
                      '13.0',
                      '21.0',
                      '22.0',
                      '23.0',
                      '24.0',
                      '3.0',
                      '30.0',
                      '32.0',
                      '39.0',
                      '4.0',
                      '43.0',
                      '44.0',
                      '5.0'
                      ]; // Specify the class codes you're interested in as an array.
var frequencies = frequency(image_classes);
print('Frequencies of each Resilience class for Landform Type Codes:', frequencies);


Export.table.toDrive({collection:frequencies, 
                     description: "frequencies_res_bylandform", 
                     fileFormat: "CSV"});
